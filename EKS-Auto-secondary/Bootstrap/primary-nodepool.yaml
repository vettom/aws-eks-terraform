# apiVersion: eks.amazonaws.com/v1
# kind: NodeClass
# metadata:
#   name: primary-nodeclass
# spec:
#   amiFamily: Bottlerocket
#   amiSelectorTerms:
#     - alias: bottlerocket@latest
#   # blockDeviceMappings:
#   #   - deviceName: /dev/xvda
#   #     ebs:
#   #       volumeSize: 2Gi
#   #       volumeType: {{ .Values.karpenter.default_vol_type }}
#   #       deleteOnTermination: true
#   #   - deviceName: /dev/xvdb
#   #     ebs:
#   #       volumeSize: {{ .Values.karpenter.default_vol_size }}
#   #       volumeType: {{ .Values.karpenter.default_vol_type }}
#         # deleteOnTermination: true
#   role: eks-auto-demo-eks-auto-2025070208060022640000000e 
#   detailedMonitoring: true
#   subnetSelectorTerms:
#     - tags:
#         # karpenter.sh/discovery: "{{ .Values.cluster_name }}"  
#         "pod_subnet": "true"
#   securityGroupSelectorTerms:
#     Id:         sg-09e20194ab45d42a3
#     # - tags:
#         # karpenter.sh/discovery: "{{ .Values.cluster_name }}"  
        
#   tags:
#     Name: karpenter-provisioned
#     karpenter/NodePool: karpenter-default
---
apiVersion: eks.amazonaws.com/v1
kind: NodeClass
metadata:
  finalizers:
  - eks.amazonaws.com/termination
  generation: 1
  labels:
    app.kubernetes.io/managed-by: eks
  name: primary-nodeclass
spec: 
  ephemeralStorage:
    iops: 3000
    size: 80Gi
    throughput: 125
  networkPolicy: DefaultAllow
  networkPolicyEventLogs: Disabled
  role: eks-auto-demo-eks-auto-2025070208060022640000000e
  securityGroupSelectorTerms:
  - id: sg-09e20194ab45d42a3
  snatPolicy: Random
  subnetSelectorTerms:
  - id: subnet-014f96a418e9b0c88
  - id: subnet-01edf450989210ecb
  podSubnetSelectorTerms:
  - id: subnet-00b69247bdae8fc55
  - id: subnet-06d7e5d8b68cf4566
    # - tags:
    #     Name: "pod-subnet"
    #     kubernetes.io/role/pod: "1"
---
apiVersion: karpenter.sh/v1
kind: NodePool
metadata:
  name: primary-nodepool
  labels:
    k8s.amazonaws.com/eniConfig: eu-west-1a
    owner: custom-nodepool
    karpenter.sh/capacity-type: spot
    karpenter.sh/nodepool: primary-nodepool
spec:
  weight: 50
  template:
    spec:
      expireAfter: 336h
      nodeClassRef:
        group: eks.amazonaws.com
        kind: NodeClass
        name: primary-nodeclass
      requirements:
      - key: topology.kubernetes.io/zone
        operator: In
        values: ["eu-west-1a"]
      - key: karpenter.sh/capacity-type
        operator: In
        values: ["spot"]
      - key: eks.amazonaws.com/instance-category
        operator: In
        values: ["c","m","r"]
      - key: eks.amazonaws.com/instance-generation
        operator: Gt
        values: ["5"]
      - key: kubernetes.io/arch
        operator: In
        values:
        - amd64
      - key: kubernetes.io/os
        operator: In
        values:
        - linux
      terminationGracePeriod: 24h0m0s
